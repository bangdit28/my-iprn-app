<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; padding: 15px; }
        input, textarea { 
            width: 100%; padding: 10px; margin-top: 5px; margin-bottom: 15px;
            background: #1e293b; border: 1px solid #334155; color: white; border-radius: 8px; box-sizing: border-box;
        }
        button { 
            width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px;
        }
        .btn-save { background: #3b82f6; color: white; }
        .btn-download { background: #10b981; color: white; }
        .btn-clear { background: #ef4444; color: white; font-size: 11px; }
        .list-item { 
            background: #1e293b; padding: 10px; border-radius: 8px; margin-bottom: 8px; font-size: 12px; border-left: 4px solid #3b82f6;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h3>üç™ FB Cookie Formatter</h3>
    
    <label>Set Password Paten:</label>
    <input type="text" id="passInput" value="tasik321" placeholder="Masukkan password...">

    <label>Tempel Cookie di sini:</label>
    <textarea id="cookieInput" rows="4" placeholder="datr=xxx; sb=xxx; ..."></textarea>

    <button class="btn-save" onclick="saveCookie()">Simpan & Format</button>
    <button class="btn-download" onclick="downloadExcel()">Download .XLSX</button>
    
    <hr style="border: 0.5px solid #334155; margin: 20px 0;">
    
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h4>Data Tersimpan:</h4>
        <button class="btn-clear" style="width: auto;" onclick="clearData()">Hapus Semua</button>
    </div>
    <div id="displayList"></div>

    <script>
        const API_URL = "royal-cyndy-bangdit28-92d925bc.koyeb.app"; // GANTI DENGAN URL KOYEB MU

        async function saveCookie() {
            const cookie = document.getElementById('cookieInput').value;
            const password = document.getElementById('passInput').value;
            
            if(!cookie) return alert("Cookie masih kosong!");

            const res = await fetch(`${API_URL}/save-cookie`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ cookie, password })
            });
            
            if(res.ok) {
                document.getElementById('cookieInput').value = '';
                loadData();
            }
        }

        async function loadData() {
            const res = await fetch(`${API_URL}/get-all`);
            const data = await res.json();
            let html = '';
            data.reverse().forEach(item => {
                html += `<div class="list-item"><b>Formatted:</b><br>${item.formatted}</div>`;
            });
            document.getElementById('displayList').innerHTML = html;
        }

        function downloadExcel() {
            window.open(`${API_URL}/download-excel`, '_blank');
        }

        async function clearData() {
            if(confirm("Hapus semua data tersimpan?")) {
                await fetch(`${API_URL}/clear-data`, {method: 'POST'});
                loadData();
            }
        }

        loadData();
    </script>
</body>
</html>
